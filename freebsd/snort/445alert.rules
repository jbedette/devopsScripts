alert tcp any any -> any 445 (
    msg:"SMBv3 CVE-2020-0796 exploit attempt";
    flow:to_server,established;
    content:"|FE|SMB|";
    content:"|40 00 00 00|";
    content:"|FF 53 4D 42|";
    byte_test:1,&,0x08;
    metadata:service netbios-ssn;
    reference:cve,2020-0796;
    classtype:attempted-admin;
    sid:1000001;
    rev:1;)

alert tcp any any -> any 445 
(
    msg:"SMBGhost attempt detected";
    flow:to_server,established;
    content:"|FC53 4AAF|";
    byte_test:1,!&,0x01,0;
    byte_test:1,&,0x08,4;
    metadata:service smb;
    reference:cve,2020-0796;
    sid:1000001;
    rev:1;
)

alert tcp any any -> any 445 (
    msg:"SMBv3 CVE-2020-0796 exploit attempt";
    flow:to_server,established;
    content:"|FE|SMB|";
    content:"|40 00 00 00|";
    content:"|FF 53 4D 42|";
    byte_test:1,&,0x08;
    metadata:service netbios-ssn;
    reference:cve,2020-0796;
    classtype:attempted-admin;
    sid:1000001;
    rev:1;
)

alert tcp any any -> any 445 (msg:"SMBv3 CVE-2020-0796 exploit attempt"; flow:to_server,established; content:"|FF 53 4D 42|", offset:4, depth:4; content:"|FE|SMB|", offset:0, depth:4; metadata:service netbios-ssn; reference:cve,2020-0796; classtype:attempted-admin; sid:1000011; rev:1;)

alert tcp $EXTERNAL_NET any -> $HOME_NET 445 (msg:"SMBGhost CVE-2020-0796 detected"; flow:to_server,established; content:"|FE 53 4D 42 40 00 00 00 00 08 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|"; fast_pattern; reference:cve,2020-0796; classtype:attempted-admin; sid:1000001; rev:1;)

